// Generated by CoffeeScript 1.4.0
(function() {
  var existsSync, fs, marked, sysPath;

  sysPath = require("path");

  fs = require("fs");

  marked = require('marked');

  existsSync = fs.existsSync || sysPath.existsSync;

  module.exports = function(app, options) {
    return app.get(/^\/(.*\.(?:markdown|md))$/, function(req, res, next) {
      var path;
      path = sysPath.join(options.dir, req.params[0]);
      if (existsSync(path)) {
        return fs.readFile(path, "utf8", function(err, data) {
          var markdown, resBody;
          if (err) {
            return next(err);
          }
          markdown = marked(data);
          resBody = "<!DOCTYPE HTML>\n<html lang=\"en-US\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Puer Markdown Preview</title>\n  <link href='/css/markdown.css' rel='stylesheet'/>\n  <script src='/js/pretty.js'></script>\n</head>\n<body onload=\"highlight()\">\n " + markdown + "\n</body>\n</html>  ";
          res.setHeader("Content-Type", "text/html");
          res.setHeader("Content-Length", Buffer.byteLength(resBody));
          return res.send(resBody);
        });
      } else {
        return next();
      }
    });
  };

}).call(this);
